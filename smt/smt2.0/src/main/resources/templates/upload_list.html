<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>题目列表</title>
    <meta http-equiv="content-type" content="text/html charset=utf-8"/>
    <link href="/css/index.css" type="text/css" rel="stylesheet" charset="utf-8">
    <script src="/js/vue@2.6.10.js"></script>
    <script src="/js/axios@0.18.0.min.js"></script>
    <script src="/js/index.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.cookie.js"></script>
    <script src="/js/rules.js"></script>
</head>
<body>
<el-container>
    <div id="app">
        <el-header style="margin-bottom: 130px">
            <h2>已添加题目列表</h2>
            <el-button type="primary" round @click="newProb()">+ 新增题目</el-button>
            <h3>请选择：</h3>
            <template style="display: inline-block">
                level
                <el-select v-model="level" width="80">
                    <el-option v-for="item in levels" :label="item" :value="item">
                    </el-option>
                </el-select>

                lesson
                <el-select v-model="lesson_id" width="80">
                    <el-option v-for="item in lessons" :label="item" :value="item">
                    </el-option>
                </el-select>

                <el-button type="primary" plain @click="select()">筛选</el-button>
            </template>
        </el-header>

        <el-main>
            <!-- 显示题目表格开始 -->
            <template>
                <el-table :data="tableData" stripe border style="width: 100%"
                          :default-sort="{prop: 'end_time', order: 'descending'}">
                    <el-table-column prop="index" label="id" width="70" sortable></el-table-column>
                    <el-table-column prop="prob_text" label="题干"></el-table-column>
                    <el-table-column prop="options" label="选项 or 空行" width="185"></el-table-column>
                    <el-table-column prop="answer_text" label="正确答案" width="150"></el-table-column>
                    <el-table-column prop="prob_attr" label="属性" width="85"></el-table-column>
                    <el-table-column prop="prob_diff" label="难度" width="80"></el-table-column>
                    <el-table-column prop="point_text" label="考点" width="110"></el-table-column>
                    <el-table-column prop="analysis" label="解析"></el-table-column>
                    <el-table-column label="操作" width="90">
                        <template slot-scope="scope">
                            <el-button size="mini" @click="editProb(scope.row.index)" type="primary">
                                <i class="el-icon-document"></i>编辑
                            </el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </template>
            <!-- 显示题目表格结束 -->
        </el-main>

    </div>
</el-container>
</body>
<script>
    new Vue({
        el: '#app',
        data: {
            level: '0',
            lesson_id: 0,
            levels: ['1', '2'],
            lessons: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
            tableData: [],

        },
        methods: {
            newProb: function () {
                $.cookie("prob_id", null);
                $.cookie("scrollTop", 0);
                window.location.replace("/upload");
            },

            select: function () {
                $.cookie("level", this.level);
                $.cookie("lesson_id", this.lesson_id);
                axios.get("/listAllProb?level=" + this.level + "&lesson_id=" + this.lesson_id.toString()
                ).then((response) => {
                    var prob_list = response.data;
                    this.tableData = [];
                    for (let i = 0; i < prob_list.length; i++) {
                        this.tableData.push({
                            'index': prob_list[i]['prob_id'],
                            'options': prob_list[i]['options'],
                            'prob_attr': prob_list[i]['prob_attr'],
                            'prob_text': prob_list[i]['prob_text'],
                            'prob_diff': prob_list[i]['prob_diff'],
                            'answer_text': prob_list[i]['answer_text'],
                            'analysis': prob_list[i]['analysis'],
                            'blank_num': prob_list[i]['blank_num'],
                            'point_text': prob_list[i]['point_text'],
                        })
                    }
                    this.$message({
                        type: 'success',
                        message: '筛选出 ' + this.tableData.length.toString() + ' 道题'
                    });
                    setTimeout(function(){document.documentElement.scrollTop = parseInt($.cookie("scrollTop"));}, 1000);
                });
            },

            editProb: function (index) {
                $.cookie("prob_id", index);
                $.cookie("scrollTop", document.documentElement.scrollTop + document.body.scrollTop);
                window.location.replace("/upload");
            }
        },

        created: function () {
            this.lesson_id = $.cookie("lesson_id");
            this.level = $.cookie("level");
            this.select();

        },
    })


</script>

</html>